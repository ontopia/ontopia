variables:
  MAVEN_CLI_OPTS: "-V -B -Dstyle.color=always"
  MAVEN_OPTS: "-Djansi.passthrough=true -Xmx512m"

build:
  image: jamesdbloom/docker-java7-maven:latest
  stage: build
  script:
    - mvn $MAVEN_CLI_OPTS clean install
  only:
    - cherry

release:
  image: jamesdbloom/docker-java7-maven:latest
  stage: deploy
  script:
    - VERSION=`date +"%Y%m%d-%H%M"`
    - mvn versions:set -DnewVersion=5.3.1-${VERSION}
    - mvn package org.apache.maven.plugins:maven-deploy-plugin:2.8.2:deploy -DaltDeploymentRepository=artifactory.switch.mssm.nl::default::https://switch.mssm.nl/artifactory/ontopia-releases
    - mvn versions:revert
  when: manual
  only:
    - cherry
